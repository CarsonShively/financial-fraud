contract:
  name: financial_fraud_dest_aggregates
  version: 2

entity:
  type: dest
  id_field: name_dest

time:
  field: step
  note: "Features are computed from history only: steps < step (no current-step leakage)."

windows:
  one_step: "step-1"
  twenty_four_step: "step-24..step-1"

redis:
  key_format: "{live_prefix}dest:{name_dest}"
  N_min: 24
  bucket_fields:
    cnt: "dest_cnt_b{i}"
    sum: "dest_sum_b{i}"

features:
  dest_txn_count_1h: "dest_cnt_b1"
  dest_amount_sum_1h: "dest_sum_b1"
  dest_txn_count_24h: "sum(dest_cnt_b1..dest_cnt_b24)"
  dest_amount_sum_24h: "sum(dest_sum_b1..dest_sum_b24)"
  default_if_missing_entity: 0.0
  tolerance: 1e-6

online_execution_order:
  - "ADVANCE(dest_key, step, N)"
  - "READ(dest_cnt_b*, dest_sum_b*)"
  - "COMPUTE(dest_aggregates)"
  - "ADD(dest_key, step, amount, N)"

parity:
  row_order: "per dest: (step, txn_id)"
